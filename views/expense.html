<html>
    <body>
        
        <head> 
            <title> Daily Expense </title>
            <link rel="stylesheet" href="style.css">
        </head>

        <header class="form-group2">
            <h1 class="expense-form"> Expense </h1>
        <!--  -->
        <form onsubmit="addExpense(event)">
            <label> Amount: </label>
            <br>
            <input id="amount" type="number" name="amount" style="width: 20rem; height: 2rem" required> </input>
            <br>
            <label> Description: </label>
            <br>
            <input id="description" type="text" name="description" style="width: 20rem; height: 2rem" required> </input>
            <br>
            <label for="category"> Choose a option:</label>
                <select name="category" id="category" style="width: 5rem; height: 2rem" >
                    <optgroup label="Choose">
                    <option value="Movie">Fuel</option>
                    <option value="Food">Food</option>
                    <option value="Travel">Travel</option>
                    <option value="Shopping">Shopping</option>
                    <option value="Other">Other</option>
                    </optgroup>
                </select>
                <button class="submit-button"> Submit </button>
            <!-- <A Href="C:\Users\HP\Desktop\SharpnerBackEndStart\expensWebAppBackend\views\expenseLogin.html" Class="Btn">Already User - Login</A> -->
        </form>
        <ul id='listOfUsers'>
            
        </ul>
    </header>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>

    <script>
        axios.defaults.headers.common["Authorization"] = localStorage.getItem("token")
        ? localStorage.getItem("token")
        : "";
        function addExpense(event) {
            event.preventDefault();
            console.log('submit envoked')
            const token = localStorage.getItem('token');
            const amount = event.target.amount.value;
            const description = event.target.description.value;
            const category =  event.target.category.value;

            const obj = {
               amount,
               description,
               category
            };
            console.log(obj, 'object ');
            console.log(token)

            axios.post("http://localhost:7000/expense/addExpense", obj,  {headers: { 'Authorization': token}} )
            .then((response) => {
                    addNewExpense(response.data.showNewExpenseDetail)
                    // alert(response.data.message);
                    location.reload();
            })
            .catch(err => console.log(err, 'happend in frontend'));
        }

        

        window.addEventListener("DOMContentLoaded", async() => {
            const token = localStorage.getItem('token');
            try {
                const res = await axios.get("http://localhost:7000/expense/userExpenses", {headers: { 'Authorization': token}})
                console.log(res.data, 'in res' )

                const expenseData = res.data.allExpenses
                for(var i=0; i< expenseData.length; i++){
                    addNewExpense(expenseData[i])
            } 
            } catch (error) {
                console.log(error, 'in error field')
            } 
        })

        function addNewExpense(expense){
        const parentNode = document.getElementById('listOfUsers');
        

        const childHTML = `<li id=${expense.id}> ${expense.amount} - ${expense.description} - ${expense.category}            
                            <button onclick=deleteUser('${expense.id}')> Delete User </button>
                            <button onclick=editUser('${expense.amount}','${expense.description}','${expense.category}','${expense.id}')> Edit User </button>  
                            </li>`
                            console.log(childHTML, 'here is the child')

        parentNode.innerHTML = parentNode.innerHTML + childHTML;

        } 

        async function editUser(amount, description, category, expenseId) {

                document.getElementById('amount').value = amount;
                document.getElementById('description').value = description;
                document.getElementById('category').value = category;

                deleteUser(expenseId)
        }


        
        async function deleteUser(expenseId){
                try {
                const resdelete = await axios.delete(`http://localhost:7000/expense/deleteExpense/${expenseId}`)
                removeUserFromScreen(expenseId)
                } catch(error) {
                    console.log(error, 'is in the deleteUserr')
                }
            }

            function removeUserFromScreen(expenseId){
                const parentNode = document.getElementById('listOfUsers');
                const childNodeToBeDeleted = document.getElementById(expenseId);
                if(childNodeToBeDeleted) {
                    parentNode.removeChild(childNodeToBeDeleted)
                }
            }

    </script>
    </body>
</html>
